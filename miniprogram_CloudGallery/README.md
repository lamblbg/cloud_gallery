# 云图廊

## 简介

实现小程序端的大文件上传。

## 关键技术

mongodb + node.js + 小程序 + vant

## 重点

1. 大文件分片上传 √
2. 上传进度监控 √
3. 图片懒加载 √
4. wx.request二次封装 √
5. 图片压缩 √
6. 图片水印 √
7. 保存为pdf ×

## 启动步骤

1. 进入项目目录
2. 安装依赖

```bash
npm install
```

3. 微信开发者工具打开

## 面试可能被问到的点

1. 微信小程序的登陆怎么做的

	> 首先调用wx.login()获取到微信登录凭证code，然后通过wx.request()把code传送到开发者服务器上，开发者服务器把code结合AppId和AppSecret发送到微信服务器提供的接口去换取openid、session_key、unionid，openid就是**用户唯一标识**，session_key则是**会话密钥**，开发者可以用session_key请求微信服务器其他接口来获取一些其他信息，所以session_key不应该泄露或者下发到小程序前端。
	有了openid 开发者服务器就可以识别是哪个用户在请求服务了，但每次都要经过这么复杂的流程才能达到这个目的不是很浪费资源吗，所以在开发者服务器要在回包中携带一个会话密钥SessionId（至于这个东西是通过设置cookies返回，还是放在响应体返回看你的需求。因为如果是小程序的话就不适用cookies，这个时候就要用响应体返回，然后小程序自行存储，后续请求自行处理携带上；如果是浏览器那么就可以通过设置cookie返回，后续不需要自己处理，cookie会自动携带在每个请求中）。
	用户成功登录后，只生成一个SessionId（其中不包含用户信息），其对应的用户信息存储在Redis上，后续通过SessionId在Redis上找到对应的用户信息

2. unionid是什么东西
	
	> 用户在微信开放平台账号下的唯一标识UnionID（若当前小程序已绑定到微信开放平台账号） 。如果开发者拥有多个移动应用、网站应用、和公众账号（包括小程序），可通过 UnionID 来区分用户的唯一性，因为只要是同一个微信开放平台账号下的移动应用、网站应用和公众账号（包括小程序），用户的 UnionID 是唯一的。换句话说，同一用户，对同一个微信开放平台下的不同应用，UnionID是相同的。
	
3. OpenID和UnionID有什么不同

    > 主要区别如下：
    >
    > 1. **OpenID**：
    >    - **定义**：OpenID 是微信用户在特定小程序或公众号中的唯一标识。每个用户在每个小程序或公众号中都有一个唯一的 OpenID。
    >    - **作用域**：OpenID 的作用范围仅限于当前的小程序或公众号。换句话说，同一个用户在不同的微信小程序或公众号中会有不同的 OpenID。
    >    - **用途**：主要用于识别和追踪用户在小程序或公众号中的行为，例如授权登录、用户状态管理等。
    > 2. **UnionID**：
    >    - **定义**：UnionID 是微信用户在同一个微信开放平台账号下的唯一标识。如果多个小程序或公众号绑定到同一个微信开放平台账号，那么同一个用户在这些小程序或公众号中会有相同的 UnionID。
    >    - **作用域**：UnionID 的作用范围横跨所有绑定到同一微信开放平台账号的小程序和公众号。
    >    - **用途**：主要用于在多个小程序或公众号之间进行用户身份的统一识别，实现数据共享和用户状态同步。
    >
    > 简而言之，OpenID 用于标识用户在单个应用（小程序或公众号）中的身份，而 UnionID 用于在多个应用之间统一标识同一个用户。如果一个开发者拥有多个小程序或公众号，并且希望在这些应用之间实现用户数据的互通，那么 UnionID 就非常有用。

4. 这个token在网络传输的过程中有没有可能被人看到

      > - 未加密的传输：如果开发者服务器和客户端（例如小程序或网页）之间的通信没有使用加密协议（如 HTTPS），那么传输的数据包可能会被第三方截获。在这种情况下，token 以及其他所有传输的数据都是不安全的。
      > - 中间人攻击（MITM）：即使使用了 HTTPS，如果客户端或服务器端的安全配置不当，攻击者可能会通过中间人攻击来截获或篡改数据。如果攻击成功，token 也可能会被泄露。
      > - 网络代理和监控：在某些网络环境中，如公司或教育机构的网络，可能会有网络监控或代理服务器，这些服务器能够看到经过的数据。
      >
      > 为了提高安全性，可以采取以下措施：
      > - 始终使用 HTTPS：确保所有的数据传输都通过 HTTPS 进行加密。
      > - 使用 HTTP 严格传输安全（HSTS）：这可以防止通信被降级到不安全的 HTTP。
      > - 定期更换 token：即使 token 被泄露，如果定期更换，攻击者也只能在有限的时间内使用它。

5. 这个token存在哪里
	
	> storage